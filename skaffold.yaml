apiVersion: skaffold/v2beta5
kind: Config
build:
  tagPolicy:
    envTemplate:
      template: "{{.IMAGE_NAME}}:{{.VERSION}}"
  artifacts:
  - image: quay.io/nvidia/vpc
deploy:
  helm:
    releases:
    - name: "vpc-{{ .ENV_NAME }}"
      chartPath: ndash-charts/vpc
      artifactOverrides:
        image: quay.io/nvidia/vpc
      valuesFiles: [ndash-charts/vpc/values.yaml]
      namespace: "{{ .ENV_NAME }}"
      wait: true
      setValueTemplates:
        imageCredentials.username: "{{ .REGISTRY_USR }}"
        imageCredentials.password: "{{ .REGISTRY_PSW }}"
        imageCredentials.registry: quay.io
        imageCredentials.email: svcngcc@nvidia.com
    flags:
      global: [--tiller-namespace=kube-system]
