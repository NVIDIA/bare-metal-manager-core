{% extends "base.html" %}

{% block title %}Managed Hosts{% endblock %}

{% block content %}
<div id="json"><a id="json-link" href="">JSON</a></div>
<h1>Managed Hosts</h1>
{% if !maintenance.is_empty() %}
<h2>Maintenance</h2>
<table>
	<thead>
		<tr>
			<th>Host ID</th>
			<th>DPU ID</th>
			<th>Maintenance Ref</th>
			<th>Maintenance Start</th>
			<th>State</th>
			<th>DPU Health</th>
			<th>IPs</th>
			<th>MACs</th>
		</tr>
	</thead>
	<tbody>
	{% for host in maintenance %}
		<tr>
			<td>{{ host.machine_id|managed_host_id_link|safe }}</td>
			<td>{{ host.dpu_properties(DpuProperty::MachineId)|safe}}</td>
			<td>{% if host.is_link_ref %}<a href="{{ host.maintenance_reference }}">{{ host.maintenance_reference }}</a>{% else %}{{ host.maintenance_reference }}{% endif %}</td>
			<td>{{ host.maintenance_start_time }}</td>
			<td>{{ host.state }} {{ host.state_reason }}</td>
			<td>{% if host.is_network_healthy %}<div class="healthy">Healthy{% else %}<div class="unhealthy">{{ host.network_err_message }}{% endif %}</div></td>
			<td style="padding: 0;">
				<table style="width: 100%;">
					<tr><th>Host BMC</th><td><a href="/admin/explored_endpoint/{{ host.host_bmc_ip }}">{{ host.host_bmc_ip }}</a></td></tr>
					<tr><th>DPU BMC</th><td>{{ host.dpu_properties(DpuProperty::BmcIp)|safe }}</td></tr>
					<tr><th>Host Admin</th><td>{{ host.host_admin_ip }}</td></tr>
					<tr><th>DPU OOB</th><td>{{ host.dpu_properties(DpuProperty::OobIp)|safe }}</td></tr>
				</table>
			</td>
			<td style="padding: 0;">
				<table style="width: 100%;">
					<tr><th>Host BMC</th><td>{{ host.host_bmc_mac }}</td></tr>
					<tr><th>DPU BMC</th><td>{{ host.dpu_properties(DpuProperty::BmcMac)|safe }}</td></tr>
					<tr><th>Host PF</th><td>{{ host.host_admin_mac }}</td></tr>
					<tr><th>DPU OOB</th><td>{{ host.dpu_properties(DpuProperty::OobMac)|safe }}</td></tr>
				</table>
			</td>
		<tr/>
	{% endfor %}
	</tbody>
</table>

<h2>Active</h2>
{% endif %}
<table>
	<thead>
		<tr>
			<th>Host ID</th>
			<th>DPU ID</th>
			<th>State</th>
			<th>DPU Health</th>
			<th>IPs</th>
			<th>MACs</th>
			<th>GPU #</th>
			<th>IB IFs #</th>
			<th>Host Memory</th>
		<tr/>
	</thead>
	<tbody>
	{% for host in active %}
		<tr>
			<td>{{ host.machine_id|managed_host_id_link|safe }}</td>
			<td>{{ host.dpu_properties(DpuProperty::MachineId)|safe }}</td>
			<td title="{{ host.state_reason }}">{{ host.state }}</td>
			<td>{% if host.is_network_healthy %}<div class="healthy">Healthy{% else %}<div class="unhealthy">{{ host.network_err_message }}{% endif %}</div></td>
			<td style="padding: 0;">
				<table style="width: 100%;">
					<tr><th>Host BMC</th><td><a href="/admin/explored_endpoint/{{ host.host_bmc_ip }}">{{ host.host_bmc_ip }}</a></td></tr>
					<tr><th>DPU BMC</th><td>{{ host.dpu_properties(DpuProperty::BmcIp)|safe }}</td></tr>
					<tr><th>Host Admin</th><td>{{ host.host_admin_ip }}</td></tr>
					<tr><th>DPU OOB</th><td>{{ host.dpu_properties(DpuProperty::OobIp)|safe }}</td></tr>
				</table>
			</td>
			<td style="padding: 0;">
				<table style="width: 100%;">
					<tr><th>Host BMC</th><td>{{ host.host_bmc_mac }}</td></tr>
					<tr><th>DPU BMC</th><td>{{ host.dpu_properties(DpuProperty::BmcMac)|safe  }}</td></tr>
					<tr><th>Host PF</th><td>{{ host.host_admin_mac }}</td></tr>
					<tr><th>DPU OOB</th><td>{{ host.dpu_properties(DpuProperty::OobMac)|safe  }}</td></tr>
				</table>
			</td>
			<td>{{ host.num_gpus }}</td>
			<td>{{ host.num_ib_ifs }}</td>
			<td>{{ host.host_memory }}</td>
		</tr>
	{% endfor %}
	</tbody>
</table>
{% endblock %}
