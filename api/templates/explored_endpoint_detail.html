{% extends "base.html" %}

{% block title %}Explored Endpoint Detail{% endblock %}

{% block content %}
<h1>Endpoint</h1>
<table>
	<tr><th>Address</th><td>{{ endpoint.address }}</td></tr>
	{% match endpoint.report %}
	{% when Some with (report) %}
	<tr><th>Endpoint Type</th><td>{{ report.endpoint_type }}</td></tr>
	<tr><th>Vendor</th><td>{% match report.vendor %}{% when Some with (vendor) %} {{ vendor|capitalize }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Machine ID</th><td>{% match report.machine_id %}{% when Some with (machine_id) %} {{ machine_id|machine_id_link|safe }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Last Exploration Error</th><td>{% match report.last_exploration_error %}{% when Some with (last_exploration_error) %} {{ last_exploration_error }} {% else %}{% endmatch %}</td></tr>
	{% else %}
	{% endmatch %}
	<tr><th>Preingestion State</th><td>{{ endpoint.preingestion_state }}</td></tr>
	<tr><th>Report Version</th><td>{{ endpoint.report_version|config_version|safe }}</td></tr>
	<tr>
		<th>Exploration requested</th>
		<td>
			{{ endpoint.exploration_requested }}
			{% if !endpoint.exploration_requested %}
				<br>
				<form id="reexplore_action" method="POST" action="/admin/explored-endpoint/{{ endpoint.address }}/reexplore">
					<input type="hidden" name="if_version_match" value="{{ endpoint.report_version }}"/>
					<button style="margin-left: 0" type="submit">Request re-exploration</button>
				</form>
			{% endif %}
		</td>
	</tr>
</table>

{% match endpoint.report %}
{% when Some with (report) %}

<h2>Systems</h2>
{% for system in report.systems %}
<table>
	<tr><th>ID</th><td>{{ system.id }}</td></tr>
	<tr><th>Manufacturer</th><td>{% match system.manufacturer %}{% when Some with (manufacturer) %} {{ manufacturer }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Model</th><td>{% match system.model %}{% when Some with (model) %} {{ model }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Serial Number</th><td>{% match system.serial_number %}{% when Some with (serial_number) %} {{ serial_number }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Power State</th><td>{{ system.power_state }}</td></tr>
	<tr><th>Ethernet Interfaces</th><td style="padding: 0;">
		<table style="width: 100%;">
			<thead>
				<tr>
					<th>ID</th>
					<th>MAC</th>
					<th>Enabled</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
			{% for iface in system.ethernet_interfaces %}
				<tr>
					<td>{% match iface.id %}{% when Some with (id) %} {{ id }} {% else %}{% endmatch %}</td>
					<td>{% match iface.mac_address %}{% when Some with (mac_address) %} {{ mac_address }} {% else %}{% endmatch %}</td>
					<td>{% match iface.interface_enabled %}{% when Some with (interface_enabled) %} {{ interface_enabled }} {% else %}{% endmatch %}</td>
					<td>{% match iface.description %}{% when Some with (description) %} {{ description }} {% else %}{% endmatch %}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</td></tr>
  <tr><th>PCIe Devices</th><td style="padding: 0;">
    <table style="width: 100;">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Manufacturer</th>
        <th>Description</th>
        <th>Firmware Version</th>
        <th>GPU Vendor</th>
        <th>Part Number</th>
        <th>Serial Number</th>
      </tr>
    </thead>
    <tbody>
    {% for pci in system.pcie_devices %}
      <tr>
        <td>{% match pci.id %}{% when Some with (id) %} {{ id }} {% else %}{% endmatch %}</td>
        <td>{% match pci.name %}{% when Some with (name) %} {{ name }} {% else %}{% endmatch %}</td>
        <td>{% match pci.manufacturer %}{% when Some with (manufacturer) %} {{ manufacturer }} {% else %}{% endmatch %}</td>
        <td>{% match pci.description %}{% when Some with (description) %} {{ description }} {% else %}{% endmatch %}</td>
        <td>{% match pci.firmware_version %}{% when Some with (firmware_version) %} {{ firmware_version }} {% else %}{% endmatch %}</td>
        <td>{% match pci.gpu_vendor %}{% when Some with (gpu_vendor) %} {{ gpu_vendor }} {% else %}{% endmatch %}</td>
        <td>{% match pci.part_number %}{% when Some with (part_number) %} {{ part_number }} {% else %}{% endmatch %}</td>
        <td>{% match pci.serial_number %}{% when Some with (serial_number) %} {{ serial_number }} {% else %}{% endmatch %}</td>
      </tr>
    {% endfor %}
      </tbody>
    </table>
  </td></tr>
</table>
{% endfor %}

<h2>Managers</h2>
{% for manager in report.managers %}
<table>
	<tr><th>ID</th><td>{{ manager.id }}</td></tr>
	<tr><th>Ethernet Interfaces</th><td style="padding: 0;">
		<table style="width: 100%;">
			<thead>
				<tr>
					<th>ID</th>
					<th>MAC</th>
					<th>Enabled</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
			{% for iface in manager.ethernet_interfaces %}
				<tr>
					<td>{% match iface.id %}{% when Some with (id) %} {{ id }} {% else %}{% endmatch %}</td>
					<td>{% match iface.mac_address %}{% when Some with (mac_address) %} {{ mac_address }} {% else %}{% endmatch %}</td>
					<td>{% match iface.interface_enabled %}{% when Some with (interface_enabled) %} {{ interface_enabled }} {% else %}{% endmatch %}</td>
					<td>{% match iface.description %}{% when Some with (description) %} {{ description }} {% else %}{% endmatch %}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</td></tr>
</table>
{% endfor %}

<h2>Chassis</h2>
{% for chassis in report.chassis %}
<table>
	<tr><th>ID</th><td>{{ chassis.id }}</td></tr>
	<tr><th>Manufacturer</th><td>{% match chassis.manufacturer %}{% when Some with (manufacturer) %} {{ manufacturer }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Model</th><td>{% match chassis.model %}{% when Some with (model) %} {{ model }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Serial Number</th><td>{% match chassis.serial_number %}{% when Some with (serial_number) %} {{ serial_number }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Part Number</th><td>{% match chassis.part_number %}{% when Some with (part_number) %} {{ part_number }} {% else %}{% endmatch %}</td></tr>
	<tr><th>Network Adapters</th><td style="padding: 0;">
		<table style="width: 100%;">
			<thead>
				<tr>
					<th>ID</th>
					<th>Manufacturer</th>
					<th>Model</th>
					<th>Part Number</th>
					<th>Serial Number</th>
				</tr>
			</thead>
			<tbody>
			{% for iface in chassis.network_adapters %}
				<tr>
					<td>{{ iface.id }}</td>
					<td>{% match iface.manufacturer %}{% when Some with (manufacturer) %} {{ manufacturer }} {% else %}{% endmatch %}</td>
					<td>{% match iface.model %}{% when Some with (model) %} {{ model }} {% else %}{% endmatch %}</td>
					<td>{% match iface.part_number %}{% when Some with (part_number) %} {{ part_number }} {% else %}{% endmatch %}</td>
					<td>{% match iface.serial_number %}{% when Some with (serial_number) %} {{ serial_number }} {% else %}{% endmatch %}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</td></tr>
</table>
{% endfor %}

<h2>Services</h2>
{% for service in report.service %}
<table>
	<tr><th>ID</th><td>{{ service.id }}</td></tr>
	<tr><th>Inventory</th><td style="padding: 0;">
		<table style="width: 100%;">
			<thead>
				<tr>
					<th>ID</th>
					<th>Version</th>
					<th>Release Date</th>
					<th>Description</th>
				</tr>
			</thead>
			<tbody>
			{% for item in service.inventories %}
				<tr>
					<td>{{ item.id }}</td>
					<td>{% match item.version %}{% when Some with (version) %} {{ version }} {% else %}{% endmatch %}</td>
					<td>{% match item.release_date %}{% when Some with (release_date) %} {{ release_date }} {% else %}{% endmatch %}</td>
					<td>{% match item.description %}{% when Some with (description) %} {{ description }} {% else %}{% endmatch %}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</td></tr>
</table>
{% endfor %}

{% else %}
{% endmatch %}

{% endblock %}
