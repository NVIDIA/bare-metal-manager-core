{% extends "base.html" %}

{% block title %}{{ filter_name }} Explored Endpoints{% endblock %}

{% block content %}
{% if active_vendor_filter == "all" && !is_errors_only %}
<div id="json"><a href="/admin/explored-endpoint.json">JSON</a></div>
{% endif %}

<h1>{{ filter_name }} Explored Endpoints{% if is_errors_only %} - Errors{% endif %}</h1>

<details {% if active_vendor_filter != "all" || is_errors_only %}open{% endif %}>
	<summary>Show filters</summary>
	<form id="filter-container" action="" method="get">
		<div>
				<label for="vendor-filter">Vendor:</label>
				<select id="vendor-filter" name="vendor-filter">
						<option value="all">All</option>
						{% for v in vendors %}
						<option value="{{ v|lower }}" {% if active_vendor_filter == v.to_lowercase() %}selected{% endif %}>{{ v|capitalize }}</option>
						{% endfor %}
						<option value="none"{% if active_vendor_filter == "none" %}selected{% endif %}>None</option>
				</select>
		</div>
		<div>
				<label for="errors-only">Errors only:</label>
				<input type="checkbox" id="errors-only" name="errors-only" {% if is_errors_only %}checked{% endif %}>
		</div>
		<div>
				<input type="submit" value="Update">
		</div>
	</form>
</details>

<table class="sortable">
	<thead>
		<tr>
			<th>Address</th>
			<th>Endpoint Type</th>
			<th>BMC MAC</th>
			<th>Vendor</th>
			<th>Machine ID</th>
			<th>Serial Numbers</th>
			<th>Power State</th>
			<th>Preingestion State</th>
			<th>Last Exploration Error</th>
		</tr>
	</thead>
	<tbody>
		{% for ep in endpoints %}
		<tr>
			<td><a href="/admin/explored-endpoint/{{ ep.address }}">{{ ep.address }}</a></td>
			<td>{{ ep.endpoint_type }}</td>
			<td>{{ ep.bmc_mac_addrs|join("\n")|escape|linebreaksbr|safe }}</td>
			<td>{{ ep.vendor }}</td>
			<td>{{ ep.machine_id|machine_id_link|safe }}</td>
			<td>{{ ep.serial_numbers|join("\n")|escape|linebreaksbr|safe }}</td>
			<td>{{ ep.power_states|join("\n")|escape|linebreaksbr|safe }}</td>
			<td>{{ ep.preingestion_state }}</td>
			<td>
				{% if ep.has_exploration_error %}
				<table align="left">
					<tr>
						<td>{{ ep.last_exploration_error }}</td>
						<td><form id="clearlasterror_action" method="POST" action="/admin/explored-endpoint/{{ ep.address }}/clear-last-error">
							<button style="margin-left: 0" type="submit">Clear</button>
						</form>
						</td>
					</tr>
				</table>
				{% endif %}
			</td>
		</tr>
		{% endfor %}
	</tbody>
	<tfoot>
		<tr>
			<th>{{ endpoints.len() }} item{% if endpoints.len() != 1 %}s{% endif %}</th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
		</tr>
	</tfoot>
</table>

{% endblock %}
