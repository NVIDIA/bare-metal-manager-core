{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div id="json"><a id="json-link" href="">JSON</a></div>
<h1>{{ title }}</h1>

<table class="sortable">
	<thead>
	<tr>
		<th>ID</th>
		<th>State</th>
		<th>Health Alerts #</th>
		<th>Associated DPU/Host</th>
		<th>Hostname</th>
		<th>IP Address</th>
		<th>MAC Address</th>
		<th>Sys Vendor</th>
		<th>Product Serial</th>
		{% if machines[0].is_host %}
			<th>GPU #</th>
			<th>IB IFs #</th>
		{% endif %}
	</tr>
	</thead>
	<tbody>
	{% for m in machines %}
		<tr>
			<td>{{ m.id|machine_id_link|safe }}</td>
			<td>{{ m.state }} {% if !m.state.contains("Ready") %}({{ m.time_in_state }}){% endif %}</td>
			<td>{% if m.health_probe_alerts == 0 %}<div class="healthy">{% else %}<div class="unhealthy">{% endif %}{{ m.health_probe_alerts }}</div></td>
			<td>{% if m.is_host %}
				{% for dpu_id in m.associated_dpu_ids %}
				{{ dpu_id|machine_id_link|safe }}
				{% endfor %}
				{% else %}
				{{ m.associated_host_id|machine_id_link|safe }}
				{% endif %}
			</td>
			<td><a href="/admin/machine/{{ m.id }}">{{ m.hostname }}</a></td>
			<td>{{ m.ip_address }}</td>
			<td>{{ m.mac_address }}</td>
			<td>{{ m.sys_vendor}}</td>
			<td>{{ m.product_serial }}</td>
			{% if m.is_host %}
				<td>{{ m.num_gpus }}</td>
				<td>{{ m.num_ib_ifs }}</td>
			{% endif %}
		</tr>
	{% endfor %}
	</tbody>
</table>

{% endblock %}
