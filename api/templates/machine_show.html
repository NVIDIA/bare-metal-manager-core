{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div id="json"><a id="json-link" href="">JSON</a></div>
<h1>{{ title }}</h1>

<table class="sortable">
	<thead>
	<tr>
		<th>#</th>
		<th>ID</th>
		<th>State</th>
		<th>Health Alerts</th>
		<th>Health Overrides #</th>
		<th>Associated DPU/Host</th>
		<th>Hostname</th>
		<th>Labels</th>
		<th>IP Address</th>
		<th>MAC Address</th>
		<th>Sys Vendor</th>
		<th>Product Serial</th>
		{% if let Some(machine) = machines.first() %}
			{% if machine.is_host %}
				<th>GPU #</th>
				<th>IB IFs #</th>
			{% endif %}
		{% endif %}
	</tr>
	</thead>
	<tbody>
	{% for m in machines %}
		<tr>
			<td>{{ loop.index }}</td> 
			<td>{{ m.id|machine_id_link|safe }}</td>
			<td>
				{{ m.state }}
				{% if !m.state.contains("Ready") %}({{ m.time_in_state }}){% endif %}
				{% if m.time_in_state_above_sla %}⏱️{% endif %}
			</td>
			<td>
				{% if m.health_probe_alerts.len() == 0 %}<div class="healthy">{% else %}<div class="unhealthy">{% endif %}
					<a href="/admin/machine/health/{{ m.id }}">
						{{ m.health_probe_alerts|health_alerts_fmt(false)|safe }}
					</a>
				</div>
			</td>
			<td><a href="/admin/machine/health/{{ m.id }}">{{ m.override_mode_counts }}</a></td>
			<td>{% if m.is_host %}
				{% for dpu_id in m.associated_dpu_ids %}
				{{ dpu_id|machine_id_link|safe }}
				{% endfor %}
				{% else %}
				{{ m.associated_host_id|machine_id_link|safe }}
				{% endif %}
			</td>
			<td><a href="/admin/machine/{{ m.id }}">{{ m.hostname }}</a></td>
			<td>{{ m.metadata.labels|label_list_fmt(true)|safe }}</td>
			<td>{{ m.ip_address }}</td>
			<td>{{ m.mac_address }}</td>
			<td>{{ m.sys_vendor}}</td>
			<td>{{ m.product_serial }}</td>
			{% if m.is_host %}
				<td>{{ m.num_gpus }}</td>
				<td>{{ m.num_ib_ifs }}</td>
			{% endif %}
		</tr>
	{% endfor %}
	</tbody>
</table>

{% endblock %}
