apiVersion: skaffold/v4beta2
kind: Config
metadata:
  name: carbide
build:
  tagPolicy:
    sha256: {}
  local:
    push: false
    useBuildkit: true
    useDockerCLI: true
  artifacts:
    - image: carbide-dns
      sync:
        infer:
          - "carbide-dns"
      docker:
        dockerfile: dev/deployment/localdev/Dockerfile.dns.localdev
    - image: carbide-pxe
      docker:
        dockerfile: dev/deployment/localdev/Dockerfile.pxe.localdev
      sync:
        infer:
          - "carbide"
          - pxe/templates/*
          - pxe/static/*
    - image: carbide-api
      docker:
        dockerfile: dev/deployment/localdev/Dockerfile.api.localdev
      sync:
        infer:
          - "carbide-api"
          - api/casbin-policy.csv
          - pxe/static/*
    - image: carbide-dhcp
      docker:
        dockerfile: dev/deployment/localdev/Dockerfile.dhcp.localdev
      sync:
        infer:
          - "libdhcp.so"
    - image: bmc-mock
      docker:
        dockerfile: dev/deployment/localdev/Dockerfile.bmc-mock.localdev
      sync:
        infer:
          - "bmc-mock"

manifests:
  kustomize:
    paths:
      - forged/envs/k3s-dev/site/site-controller

deploy:
  kubeContext: k3s-dev
  kubectl:
    defaultNamespace: forge-system

